
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>crrlpy.crrls &#8212; CRRLpy 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../_static/copybutton.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CRRLpy 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for crrlpy.crrls</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">havedisplay</span> <span class="o">=</span> <span class="s2">&quot;DISPLAY&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">havedisplay</span><span class="p">:</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="k">import</span> <span class="n">wofz</span>
<span class="kn">from</span> <span class="nn">astropy.constants</span> <span class="k">import</span> <span class="n">c</span><span class="p">,</span> <span class="n">k_B</span>

<span class="kn">from</span> <span class="nn">crrlpy</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.frec_calc</span> <span class="k">import</span> <span class="n">set_dn</span><span class="p">,</span> <span class="n">make_line_list</span>

<div class="viewcode-block" id="alphanum_key"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.alphanum_key">[docs]</a><span class="k">def</span> <span class="nf">alphanum_key</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Turn a string into a list of string and number chunks.</span>
<span class="sd">    </span>
<span class="sd">    :param s: String</span>
<span class="sd">    :returns: List with strings and integers.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; alphanum_key(&#39;z23a&#39;)</span>
<span class="sd">    [&#39;z&#39;, 23, &#39;a&#39;]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">tryint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;([0-9]+)&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">]</span></div>

<div class="viewcode-block" id="average"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.average">[docs]</a><span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Averages data along the given axis by combining n adjacent values.</span>
<span class="sd">    </span>
<span class="sd">    :param data: Data to average along a given axis.</span>
<span class="sd">    :type data: numpy array</span>
<span class="sd">    :param axis: Axis along which to average.</span>
<span class="sd">    :type axis: int</span>
<span class="sd">    :param n: Factor by which to average.</span>
<span class="sd">    :type n: int</span>
<span class="sd">    :returns: Data decimated by a factor n along the given axis.</span>
<span class="sd">    :rtype: numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">swpdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Will not work&quot;</span><span class="p">)</span>
        <span class="n">avg_tmp</span> <span class="o">=</span> <span class="n">swpdata</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avg_tmp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">si</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">si</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">avg_tmp</span> <span class="o">+=</span> <span class="n">swpdata</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="n">n</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_tmp</span> <span class="o">+=</span> <span class="n">swpdata</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="o">-</span><span class="n">si</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
        <span class="n">avg_tmp</span> <span class="o">=</span> <span class="n">avg_tmp</span><span class="o">/</span><span class="n">n</span>
        
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">avg_tmp</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="best_match_indx_tol"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.best_match_indx_tol">[docs]</a><span class="k">def</span> <span class="nf">best_match_indx_tol</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Searchs for the best match to a value inside an array given a tolerance.</span>
<span class="sd">    </span>
<span class="sd">    :param value: Value to find inside the array.</span>
<span class="sd">    :type value: float</span>
<span class="sd">    :param tol: Tolerance for match.</span>
<span class="sd">    :type tol: float</span>
<span class="sd">    :param array: List to search for the given value.</span>
<span class="sd">    :type array: numpy.array</span>
<span class="sd">    :return: Best match for val inside array.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">upp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">array</span> <span class="o">&gt;=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">array</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">upp</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">low</span><span class="p">)):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">upp</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">low</span><span class="p">))</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="c1">#return iter(set(upp) &amp; set(low)).next()</span>
    <span class="k">elif</span> <span class="n">low</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">low</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#return low[-1]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">upp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#return upp[0]</span>
    <span class="k">return</span> <span class="n">out</span></div>
    
<span class="c1">#def best_match_indx(value, array):</span>
    <span class="c1">#&quot;&quot;&quot;</span>
    <span class="c1">#Searchs for the index of the closest entry to value inside an array.</span>
    
    <span class="c1">#:param value: Value to find inside the array.</span>
    <span class="c1">#:type value: float</span>
    <span class="c1">#:param array: List to search for the given value.</span>
    <span class="c1">#:type array: list or numpy.array</span>
    <span class="c1">#:return: Best match index for the value inside array.</span>
    <span class="c1">#:rtype: float</span>
    
    <span class="c1">#:Example:</span>
    
    <span class="c1">#&gt;&gt;&gt; a = [1,2,3,4]</span>
    <span class="c1">#&gt;&gt;&gt; best_match_indx(3, a)</span>
    <span class="c1">#2</span>
    
    <span class="c1">#&quot;&quot;&quot;</span>
    
    <span class="c1">#array = np.array(array)</span>
    <span class="c1">#subarr = abs(array - value)</span>
    <span class="c1">#subarrmin = subarr.min()</span>
        
    <span class="c1">#return np.where(subarr == subarrmin)[0][0]</span>

<div class="viewcode-block" id="best_match_value"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.best_match_value">[docs]</a><span class="k">def</span> <span class="nf">best_match_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Searchs for the closest ocurrence of value in array.</span>
<span class="sd">    </span>
<span class="sd">    :param value: Value to find inside the array.</span>
<span class="sd">    :type value: float</span>
<span class="sd">    :param array: List to search for the given value.</span>
<span class="sd">    :type array: list or numpy.array</span>
<span class="sd">    :return: Best match for the value inside array.</span>
<span class="sd">    :rtype: float.</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; a = [1,2,3,4]</span>
<span class="sd">    &gt;&gt;&gt; best_match_value(3.5, a)</span>
<span class="sd">    3</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">subarr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">subarrmin</span> <span class="o">=</span> <span class="n">subarr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">subarr</span> <span class="o">==</span> <span class="n">subarrmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span></div>
    
<div class="viewcode-block" id="blank_lines"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.blank_lines">[docs]</a><span class="k">def</span> <span class="nf">blank_lines</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">reffreqs</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Blanks the lines in a spectra.</span>
<span class="sd">    </span>
<span class="sd">    :param freq: Frequency axis of the spectra.</span>
<span class="sd">    :type freq: array, MHz</span>
<span class="sd">    :param tau: Optical depth axis of the spectra.</span>
<span class="sd">    :type tau: array</span>
<span class="sd">    :param reffreqs: List with the reference frequency of the lines. Should be the rest frequency.</span>
<span class="sd">    :type reffreqs: list</span>
<span class="sd">    :param v0: Velocity shift to apply to the lines defined by `reffreq`. (km/s)</span>
<span class="sd">    :type v0: float</span>
<span class="sd">    :param dv: Velocity range to blank around the lines. (km/s)</span>
<span class="sd">    :type dv: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">reffreqs</span><span class="p">:</span>
            <span class="c1">#print &quot;#freq: {0} #tau: {1}&quot;.format(len(freq), len(tau))</span>
            <span class="n">lm0</span><span class="p">,</span> <span class="n">lmf</span> <span class="o">=</span> <span class="n">get_line_mask</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">dv0</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">freq</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tau</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">tau</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">lm0</span><span class="p">,</span> <span class="n">lmf</span> <span class="o">=</span> <span class="n">get_line_mask</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">reffreqs</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">dv0</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">freq</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tau</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">tau</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
        
    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">tau</span></div>

<div class="viewcode-block" id="blank_lines2"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.blank_lines2">[docs]</a><span class="k">def</span> <span class="nf">blank_lines2</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">reffreqs</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Blanks the lines in a spectra. </span>
<span class="sd">    </span>
<span class="sd">    :param freq: Frequency axis of the spectra. (MHz)</span>
<span class="sd">    :type freq: array</span>
<span class="sd">    :param tau: Optical depth axis of the spectra.</span>
<span class="sd">    :type tau: array</span>
<span class="sd">    :param reffreqs: List with the reference frequency of the lines. Should be the rest frequency.</span>
<span class="sd">    :type reffreqs: list</span>
<span class="sd">    :param dv: Velocity range to blank around the lines. (km/s)</span>
<span class="sd">    :type dv: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">reffreqs</span><span class="p">:</span>
            <span class="c1">#print &quot;#freq: {0} #tau: {1}&quot;.format(len(freq), len(tau))</span>
            <span class="c1">#print &quot;reffreq: {0}&quot;.format(ref)</span>
            <span class="n">lm0</span><span class="p">,</span> <span class="n">lmf</span> <span class="o">=</span> <span class="n">get_line_mask2</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">freq</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tau</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">tau</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">lm0</span><span class="p">,</span> <span class="n">lmf</span> <span class="o">=</span> <span class="n">get_line_mask2</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">reffreqs</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">freq</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tau</span><span class="p">[:</span><span class="n">lm0</span><span class="p">],</span> <span class="n">tau</span><span class="p">[</span><span class="n">lmf</span><span class="p">:]))</span>
        
    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">tau</span></div>


<div class="viewcode-block" id="df2dv"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.df2dv">[docs]</a><span class="k">def</span> <span class="nf">df2dv</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a frequency delta to a velocity delta given a central frequency.</span>
<span class="sd">    </span>
<span class="sd">    :param f0: Rest frequency.</span>
<span class="sd">    :type f0: float</span>
<span class="sd">    :param df: Frequency delta.</span>
<span class="sd">    :type df: float</span>
<span class="sd">    :returns: The equivalent velocity delta for the given frequency delta.</span>
<span class="sd">    :rtype: float in :math:`\mbox{m s}^{-1}`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span></div>


<div class="viewcode-block" id="doppler_broad"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.doppler_broad">[docs]</a><span class="k">def</span> <span class="nf">doppler_broad</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">vrms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Doppler broadening.</span>
<span class="sd">    </span>
<span class="sd">    :math:`\\frac{\Delta v}{\mbox{m s}^{-1}}=(\\frac{k_{B}T}{m}+v_{\mathrm{rms}}^2)^{1/2}`</span>
<span class="sd">    </span>
<span class="sd">    :param t: Gas temperature in K.</span>
<span class="sd">    :type t: float</span>
<span class="sd">    :param m: Mass of the element producing the line in amu.</span>
<span class="sd">    :type m: float</span>
<span class="sd">    :param vrms: Turbulent velocity.</span>
<span class="sd">    :type vrms: float</span>
<span class="sd">    :returns: The FWHM of a Gaussian line due to Doppler broadening in :math:`\mbox{m s}^{-1}`.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8254.39975673</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">m</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">vrms</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))</span>
    
    <span class="n">fwhm</span> <span class="o">=</span> <span class="n">sigma2fwhm</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fwhm</span></div>


<div class="viewcode-block" id="dv2df"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.dv2df">[docs]</a><span class="k">def</span> <span class="nf">dv2df</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a velocity delta to a frequency delta given a central frequency.</span>
<span class="sd">    </span>
<span class="sd">    :param f0: Rest frequency.</span>
<span class="sd">    :type f0: float</span>
<span class="sd">    :param dv: Velocity delta in m/s.</span>
<span class="sd">    :type dv: float</span>
<span class="sd">    :returns: For the given velocity delta the equivalent frequency delta.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">dv</span><span class="o">*</span><span class="n">f0</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="dv_minus_doppler"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.dv_minus_doppler">[docs]</a><span class="k">def</span> <span class="nf">dv_minus_doppler</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="n">ddV</span><span class="p">,</span> <span class="n">dD</span><span class="p">,</span> <span class="n">ddD</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the Lorentzian contribution to the line width assuming that the line has a Voigt profile.</span>
<span class="sd">    </span>
<span class="sd">    :param dV: Total line width</span>
<span class="sd">    :type dV: float</span>
<span class="sd">    :param ddV: Uncertainty in the total line width.</span>
<span class="sd">    :type ddV: float</span>
<span class="sd">    :param dD: Doppler contribution to the line width.</span>
<span class="sd">    :type dD: float</span>
<span class="sd">    :param ddD: Uncertainty in the Doppler contribution to the line width.</span>
<span class="sd">    :returns: The Lorentz contribution to the total line width.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5346</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.2166</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No real solutions, check input.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">dL_p</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
    <span class="n">dL_m</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">dL_m</span> <span class="o">&lt;</span> <span class="n">dV</span><span class="p">:</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="n">dL_m</span>
        <span class="n">ddL1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span> <span class="o">-</span> <span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">)</span> <span class="o">+</span> <span class="mf">8.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">dV</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="n">dL_p</span>
        <span class="n">ddL1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">)</span> <span class="o">+</span> <span class="mf">8.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">dV</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
        
    <span class="n">ddL2</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">dD</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>
    
    <span class="n">ddL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">ddL1</span><span class="o">*</span><span class="n">ddV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">ddL2</span><span class="o">*</span><span class="n">ddV</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> 
    
    <span class="k">return</span> <span class="n">dL</span><span class="p">,</span> <span class="n">ddL</span></div>

<div class="viewcode-block" id="dv_minus_doppler2"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.dv_minus_doppler2">[docs]</a><span class="k">def</span> <span class="nf">dv_minus_doppler2</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="n">ddV</span><span class="p">,</span> <span class="n">dD</span><span class="p">,</span> <span class="n">ddD</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the Lorentzian contribution to the line width assuming that the line has a Voigt profile.</span>
<span class="sd">    </span>
<span class="sd">    :param dV: Total line width</span>
<span class="sd">    :type dV: float</span>
<span class="sd">    :param ddV: Uncertainty in the total line width.</span>
<span class="sd">    :type ddV: float</span>
<span class="sd">    :param dD: Doppler contribution to the line width.</span>
<span class="sd">    :type dD: float</span>
<span class="sd">    :param ddD: Uncertainty in the Doppler contribution to the line width.</span>
<span class="sd">    :returns: The Lorentz contribution to the total line width.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5346</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.2166</span>
    
    <span class="n">den</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">dif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dV</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">den</span><span class="o">*</span><span class="n">dif</span>
    
    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No real solutions, check input.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">dL_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">/</span><span class="n">den</span>
    <span class="n">dL_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">/</span><span class="n">den</span>
    
    <span class="k">if</span> <span class="n">dL_m</span> <span class="o">&lt;</span> <span class="n">dV</span><span class="p">:</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="n">dL_m</span>
        <span class="n">ddL1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span> <span class="o">-</span> <span class="n">dV</span><span class="o">*</span><span class="n">den</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">den</span><span class="o">*</span><span class="n">dif</span><span class="p">))</span><span class="o">/</span><span class="n">den</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="n">dL_p</span>
        <span class="n">ddL1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span> <span class="o">-</span> <span class="n">dV</span><span class="o">*</span><span class="n">den</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">den</span><span class="o">*</span><span class="n">dif</span><span class="p">))</span><span class="o">/</span><span class="n">den</span>
        
    <span class="n">ddL2</span> <span class="o">=</span> <span class="n">dD</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">dV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">den</span><span class="o">*</span><span class="n">dif</span><span class="p">)</span>
    
    <span class="n">ddL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">ddL1</span><span class="o">*</span><span class="n">ddV</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">ddL2</span><span class="o">*</span><span class="n">ddV</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> 
    
    <span class="k">return</span> <span class="n">dL</span><span class="p">,</span> <span class="n">ddL</span></div>

<div class="viewcode-block" id="f2n"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.f2n">[docs]</a><span class="k">def</span> <span class="nf">f2n</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">1500</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a given frequency to a principal quantum number :math:`n` for a given line.</span>
<span class="sd">    </span>
<span class="sd">    :param f: Frequency to convert. (MHz)</span>
<span class="sd">    :type f: array</span>
<span class="sd">    :param line: The equivalent :math:`n` will be referenced to this line.</span>
<span class="sd">    :type line: string</span>
<span class="sd">    :param n_max: Maximum n number to include in the search. (optional, Default 1)</span>
<span class="sd">    :type n_max: int</span>
<span class="sd">    :returns: Corresponding :math:`n` for a given frequency and line. \</span>
<span class="sd">    If the frequency is not an exact match, then it will return an empty array.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">line</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="n">make_line_list</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">)</span>
    <span class="n">fii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">nn</span><span class="p">[</span><span class="n">fii</span><span class="p">]</span></div>

<div class="viewcode-block" id="find_lines_sb"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.find_lines_sb">[docs]</a><span class="k">def</span> <span class="nf">find_lines_sb</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds if there are any lines of a given type in the frequency range.</span>
<span class="sd">    The line frequencies are corrected for redshift.</span>
<span class="sd">    </span>
<span class="sd">    :param freq: Frequency axis in which to search for lines (MHz). It should not contain \</span>
<span class="sd">    NaN or inf values.</span>
<span class="sd">    :type freq: array</span>
<span class="sd">    :param line: Line type to search for.</span>
<span class="sd">    :type line: string</span>
<span class="sd">    :param z: Redshift to apply to the rest frequencies.</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :param verbose: Verbose output?</span>
<span class="sd">    :type verbose: bool</span>
<span class="sd">    :returns: Lists with the princpipal quantum number and the reference \</span>
<span class="sd">    frequency of the line. The frequencies are redshift corrected in MHz.</span>
<span class="sd">    :rtype: array.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    load_ref : Describes the format of line and the available ones.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from crrlpy import crrls</span>
<span class="sd">    &gt;&gt;&gt; freq = [10, 11]</span>
<span class="sd">    &gt;&gt;&gt; ns, rf = crrls.find_lines_sb(freq, &#39;RRL_CIalpha&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ns</span>
<span class="sd">    array([ 843.,  844.,  845.,  846.,  847.,  848.,  849.,  850.,  851.,</span>
<span class="sd">            852.,  853.,  854.,  855.,  856.,  857.,  858.,  859.,  860.,</span>
<span class="sd">            861.,  862.,  863.,  864.,  865.,  866.,  867.,  868.,  869.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Load the reference frequencies.</span>
    <span class="n">qn</span><span class="p">,</span> <span class="n">restfreq</span> <span class="o">=</span> <span class="n">load_ref</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="c1"># Correct rest frequencies for redshift.</span>
    <span class="n">reffreq</span> <span class="o">=</span> <span class="n">restfreq</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">z</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Subband edges: </span><span class="si">{0}</span><span class="s2">--</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    
    <span class="c1"># Check which lines lie within the sub band.</span>
    <span class="n">mask_ref</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">reffreq</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">reffreq</span><span class="p">)</span>
    <span class="n">reffreqs</span> <span class="o">=</span> <span class="n">reffreq</span><span class="p">[</span><span class="n">mask_ref</span><span class="p">]</span>
    <span class="n">refqns</span> <span class="o">=</span> <span class="n">qn</span><span class="p">[</span><span class="n">mask_ref</span><span class="p">]</span>
    
    <span class="n">nlin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reffreqs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> lines within the subband.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlin</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nlin</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Corresponding to n values: </span><span class="si">{0}</span><span class="s2">--</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">refqns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">refqns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">nlin</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Corresponding to n value </span><span class="si">{0}</span><span class="s2"> and frequency </span><span class="si">{1}</span><span class="s2"> MHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">refqns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reffreqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">refqns</span><span class="p">,</span> <span class="n">reffreqs</span></div>

<div class="viewcode-block" id="freq2vel"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.freq2vel">[docs]</a><span class="k">def</span> <span class="nf">freq2vel</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a frequency axis to a velocity axis given a central frequency.</span>
<span class="sd">    Uses the radio definition of velocity.</span>
<span class="sd">    </span>
<span class="sd">    :param f0: Rest frequency for the conversion. (Hz)</span>
<span class="sd">    :type f0: float</span>
<span class="sd">    :param f: Frequencies to be converted to velocity. (Hz)</span>
<span class="sd">    :type f: numpy array</span>
<span class="sd">    :returns: f converted to velocity given a rest frequency :math:`f_{0}`.</span>
<span class="sd">    :rtype: numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">f</span><span class="o">/</span><span class="n">f0</span><span class="p">)</span></div>

<div class="viewcode-block" id="fwhm2sigma"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.fwhm2sigma">[docs]</a><span class="k">def</span> <span class="nf">fwhm2sigma</span><span class="p">(</span><span class="n">fwhm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a FWHM to the standard deviation, :math:`\\sigma` of a Gaussian distribution.</span>
<span class="sd">    </span>
<span class="sd">    .. math:</span>
<span class="sd">       </span>
<span class="sd">       FWHM=2\\sqrt{2\\ln2}\\sigma</span>
<span class="sd">       </span>
<span class="sd">    :param fwhm: FWHM of the Gaussian.</span>
<span class="sd">    :type fwhm: array</span>
<span class="sd">    :returns: Equivalent standard deviation of a Gausian with a Full Width at Half Maximum `fwhm`.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; 1/fwhm2sigma(1)</span>
<span class="sd">    2.3548200450309493</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">fwhm</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">)))</span></div>

<div class="viewcode-block" id="gauss_area"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.gauss_area">[docs]</a><span class="k">def</span> <span class="nf">gauss_area</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the area under a Gaussian of a given amplitude and sigma.</span>
<span class="sd">    </span>
<span class="sd">    .. math:</span>
<span class="sd">    </span>
<span class="sd">        Area=\\sqrt(2\\pi)A\\sigma</span>
<span class="sd">        </span>
<span class="sd">    :param amplitude: Amplitude of the Gaussian, :math:`A`.</span>
<span class="sd">    :type A: array</span>
<span class="sd">    :param sigma: Standard deviation fo the Gaussian, :math:`\\sigma`.</span>
<span class="sd">    :type sigma: array</span>
<span class="sd">    :returns: The area under a Gaussian of a given amplitude and standard deviation.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">amplitude</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span></div>

<div class="viewcode-block" id="gauss_area_err"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.gauss_area_err">[docs]</a><span class="k">def</span> <span class="nf">gauss_area_err</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">amplitude_err</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">sigma_err</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the error on the area of a Gaussian of a given `amplitude` and `sigma` \</span>
<span class="sd">    with their corresponding errors. It assumes no correlation between `amplitude` and </span>
<span class="sd">    `sigma`.</span>
<span class="sd">    </span>
<span class="sd">    :param amplitude: Amplitude of the Gaussian.</span>
<span class="sd">    :type amplitude: array</span>
<span class="sd">    :param amplitude_err: Error on the amplitude.</span>
<span class="sd">    :type amplitude_err: array</span>
<span class="sd">    :param sigma: Standard deviation of the Gaussian.</span>
<span class="sd">    :param sigma_err: Error on sigma.</span>
<span class="sd">    :returns: The error on the area.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">err1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">amplitude_err</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">err2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sigma_err</span><span class="o">*</span><span class="n">amplitude</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err1</span> <span class="o">+</span> <span class="n">err2</span><span class="p">)</span></div>

<div class="viewcode-block" id="gauss_area2peak"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.gauss_area2peak">[docs]</a><span class="k">def</span> <span class="nf">gauss_area2peak</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the maximum value of a Gaussian function given its</span>
<span class="sd">    amplitude and standard deviation &quot;math:`\\sigma`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">area</span><span class="o">/</span><span class="n">sigma</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span></div>

<div class="viewcode-block" id="gauss_area2peak_err"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.gauss_area2peak_err">[docs]</a><span class="k">def</span> <span class="nf">gauss_area2peak_err</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">darea</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">dsigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the maximum value of a Gaussian function given its</span>
<span class="sd">    amplitude, area and standard deviation &quot;math:`\\sigma`.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">err1</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">/</span><span class="n">area</span><span class="o">*</span><span class="n">darea</span>
    <span class="n">err2</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">/</span><span class="n">sigma</span><span class="o">*</span><span class="n">dsigma</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">err1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">err2</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))</span></div>

<div class="viewcode-block" id="gaussian"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.gaussian">[docs]</a><span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gaussian function in one dimension.</span>
<span class="sd">    </span>
<span class="sd">    :param x: x values for which to evaluate the Gaussian.</span>
<span class="sd">    :type x: array</span>
<span class="sd">    :param sigma: Standard deviation of the Gaussian.</span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :param center: Center of the Gaussian.</span>
<span class="sd">    :type center: float</span>
<span class="sd">    :param amplitude: Peak value of the Gaussian.</span>
<span class="sd">    :type amplitude: float</span>
<span class="sd">    :returns: Gaussian function of the given amplitude and standard deviation evaluated at x.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#return amplitude/(sigma*np.sqrt(2.*np.pi))*np.exp(-np.power((x - center), 2.)/(2.*np.power(sigma, 2.)))</span>
    <span class="k">return</span> <span class="n">amplitude</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span></div>

<div class="viewcode-block" id="get_axis"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.get_axis">[docs]</a><span class="k">def</span> <span class="nf">get_axis</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a cube axis.</span>
<span class="sd">    </span>
<span class="sd">    :param header: Fits cube header.</span>
<span class="sd">    :type header: pyfits header</span>
<span class="sd">    :param axis: Axis to reconstruct.</span>
<span class="sd">    :type axis: int</span>
<span class="sd">    :returns: cube axis</span>
<span class="sd">    :rtype: numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CDELT&quot;</span> <span class="o">+</span> <span class="n">axis</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CRPIX&quot;</span> <span class="o">+</span> <span class="n">axis</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CRVAL&quot;</span> <span class="o">+</span> <span class="n">axis</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NAXIS&quot;</span> <span class="o">+</span> <span class="n">axis</span><span class="p">)</span>
    
    <span class="n">p0</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># Fits files index start at 1, not for python.</span>
    
    <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">p0</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">p0</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">axis</span></div>

<div class="viewcode-block" id="get_rchi2"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.get_rchi2">[docs]</a><span class="k">def</span> <span class="nf">get_rchi2</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">x_mod</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">y_mod</span><span class="p">,</span> <span class="n">dy_obs</span><span class="p">,</span> <span class="n">dof</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the reduced :math:`\\chi` squared, :math:`\\chi_{\\nu}^{2}=\\chi^{2}/dof`.</span>
<span class="sd">    </span>
<span class="sd">    :param x_obs: Abscissa values of the observations.</span>
<span class="sd">    :type x_obs: array</span>
<span class="sd">    :param x_mod: Abscissa values of the model.</span>
<span class="sd">    :type x_mod: array</span>
<span class="sd">    :param y_obs: Ordinate values of the observations.</span>
<span class="sd">    :type y_obs: array</span>
<span class="sd">    :param y_mod: Ordinate values of the model.</span>
<span class="sd">    :type y_mod: array</span>
<span class="sd">    :param dy_obs: Error on the ordinate values of the observations.</span>
<span class="sd">    :type dy_obs: array</span>
<span class="sd">    :param dof: Degrees of freedom.</span>
<span class="sd">    :type dof: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># Find the equivalent model points</span>
    <span class="n">n_indx_mod</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_obs</span><span class="p">):</span>
        <span class="n">n_indx_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_mod</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_mod</span><span class="p">[</span><span class="n">n_indx_mod</span><span class="p">],</span> <span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dy_obs</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">dof</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_line_mask"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.get_line_mask">[docs]</a><span class="k">def</span> <span class="nf">get_line_mask</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">reffreq</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a mask with ranges where a line is expected in the given frequency range for \</span>
<span class="sd">    a line with a given reference frequency at expected velocity v0 and line width dv0.</span>
<span class="sd">    </span>
<span class="sd">    :param freq: Frequency axis where the line is located.</span>
<span class="sd">    :type freq: numpy array or list</span>
<span class="sd">    :param reffreq: Reference frequency for the line.</span>
<span class="sd">    :type reffreq: float</span>
<span class="sd">    :param v0: Velocity of the line.</span>
<span class="sd">    :type v0: float, km/s</span>
<span class="sd">    :param dv: Velocity range to mask.</span>
<span class="sd">    :type dv: float, km/s</span>
<span class="sd">    :returns: Mask centered at the line center and width `dv0` referenced to the input `freq`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">f0</span> <span class="o">=</span> <span class="n">vel2freq</span><span class="p">(</span><span class="n">reffreq</span><span class="p">,</span> <span class="n">v0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
    <span class="n">df0</span> <span class="o">=</span> <span class="n">dv2df</span><span class="p">(</span><span class="n">reffreq</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">dv0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">f0_indx</span> <span class="o">=</span> <span class="n">best_match_indx</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">df</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    
    <span class="n">mindx0</span> <span class="o">=</span> <span class="n">f0_indx</span> <span class="o">-</span> <span class="n">df0</span><span class="o">/</span><span class="n">df</span><span class="o">/</span><span class="mf">1e6</span>
    <span class="n">mindxf</span> <span class="o">=</span> <span class="n">f0_indx</span> <span class="o">+</span> <span class="n">df0</span><span class="o">/</span><span class="n">df</span><span class="o">/</span><span class="mf">1e6</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">mindx0</span><span class="p">,</span> <span class="n">mindxf</span><span class="p">]</span></div>

<div class="viewcode-block" id="get_line_mask2"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.get_line_mask2">[docs]</a><span class="k">def</span> <span class="nf">get_line_mask2</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">reffreq</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a mask with ranges where a line is expected in the given frequency range for \</span>
<span class="sd">    a line with a given reference frequency and line width dv.</span>
<span class="sd">    </span>
<span class="sd">    :param freq: Frequency axis where the line is located.</span>
<span class="sd">    :type freq: numpy array or list</span>
<span class="sd">    :param reffreq: Reference frequency for the line.</span>
<span class="sd">    :type reffreq: float</span>
<span class="sd">    :param dv: Velocity range to mask.</span>
<span class="sd">    :type dv: float, km/s</span>
<span class="sd">    :returns: Mask centered at the line center and width `dv0` referenced to the input `freq`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">dv2df</span><span class="p">(</span><span class="n">reffreq</span><span class="p">,</span> <span class="n">dv</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
    <span class="n">df_chan</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_min_sep</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">f0_indx</span> <span class="o">=</span> <span class="n">best_match_indx</span><span class="p">(</span><span class="n">reffreq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>

    <span class="n">f_mini</span> <span class="o">=</span> <span class="n">f0_indx</span> <span class="o">-</span> <span class="n">df</span><span class="o">/</span><span class="n">df_chan</span>
    <span class="k">if</span> <span class="n">f_mini</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">f_mini</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">f_maxi</span> <span class="o">=</span> <span class="n">f0_indx</span> <span class="o">+</span> <span class="n">df</span><span class="o">/</span><span class="n">df_chan</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">f_mini</span><span class="p">,</span> <span class="n">f_maxi</span><span class="p">]</span></div>

<div class="viewcode-block" id="get_rms"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.get_rms">[docs]</a><span class="k">def</span> <span class="nf">get_rms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the rms of the given data.</span>
<span class="sd">    </span>
<span class="sd">    :param data: Array with values where to compute the rms.</span>
<span class="sd">    :type data: numpy array or list</span>
<span class="sd">    :param axis: Axis over which to compute the rms. Default: None</span>
<span class="sd">    :type axis: int</span>
<span class="sd">    :returns: The rms of data.</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">    </span>
<span class="sd">        \\mbox{rms}=\\sqrt{\\langle\\mbox{data}\\rangle^{2}+V[\\mbox{data}]}</span>
<span class="sd">        </span>
<span class="sd">    where :math:`V` is the variance of the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">+</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="mf">2.</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">rms</span></div>

<div class="viewcode-block" id="is_number"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.is_number">[docs]</a><span class="k">def</span> <span class="nf">is_number</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks wether a string is a number or not.</span>
<span class="sd">    </span>
<span class="sd">    :param str: String.</span>
<span class="sd">    :type str: string</span>
<span class="sd">    :returns: True if `str` can be converted to a float.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; is_number(&#39;10&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="lambda2vel"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.lambda2vel">[docs]</a><span class="k">def</span> <span class="nf">lambda2vel</span><span class="p">(</span><span class="n">wav0</span><span class="p">,</span> <span class="n">wav</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a wavelength axis to a velocity axis given a rest wavelength.</span>
<span class="sd">    Uses the optical definition of velocity.</span>
<span class="sd">    </span>
<span class="sd">    :param wav0: Rest frequency for the conversion.)</span>
<span class="sd">    :type wav0: float</span>
<span class="sd">    :param wav: Frequencies to be converted to velocity.</span>
<span class="sd">    :type wav: numpy array</span>
<span class="sd">    :returns: Velocity. (Default: m/s)</span>
<span class="sd">    :rtype: numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">wav</span><span class="o">/</span><span class="n">wav0</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span></div>

<div class="viewcode-block" id="levelpopc"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.levelpopc">[docs]</a><span class="k">def</span> <span class="nf">levelpopc</span><span class="p">(</span><span class="n">electemp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">g12</span> <span class="o">=</span> <span class="mf">2.</span>
    <span class="n">g32</span> <span class="o">=</span> <span class="mf">4.</span>

    <span class="k">return</span> <span class="n">g32</span><span class="o">/</span><span class="n">g12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">92.</span><span class="o">/</span><span class="n">electemp</span><span class="p">)</span></div>

<div class="viewcode-block" id="linear"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.linear">[docs]</a><span class="k">def</span> <span class="nf">linear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linear model.</span>
<span class="sd">    </span>
<span class="sd">    :param x: x values where to evalueate the line.</span>
<span class="sd">    :type x: array</span>
<span class="sd">    :param a: Slope of the line.</span>
<span class="sd">    :type a: float</span>
<span class="sd">    :param b: y value for x equals 0.</span>
<span class="sd">    :type b: float</span>
<span class="sd">    :returns: A line defined by :math:`ax+b`.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span></div>

<div class="viewcode-block" id="load_model"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.load_model">[docs]</a><span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">specie</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a model for the CRRL emission.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">LOCALDIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">ldir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">/</span><span class="si">{1}</span><span class="s2">/</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOCALDIR</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;radtrans&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">specie</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;width&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">_linewidth.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">_line.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;width&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_linewidth.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_line.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;width&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{4}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">_linewidth.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">specie</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{4}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{3}</span><span class="s1">_line.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">specie</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;width&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{4}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_linewidth.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">specie</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mod_file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/Diffuse_CMB_bn_velturb_</span><span class="si">{4}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">_line.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ldir</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">specie</span><span class="p">)</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">mod_file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;width&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
        
        <span class="n">qni</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">qnf</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">dD</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dLc</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">dLr</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">qni</span><span class="p">,</span> <span class="n">qnf</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">dD</span><span class="p">,</span> <span class="n">dLc</span><span class="p">,</span> <span class="n">dLr</span><span class="p">,</span> <span class="n">I</span><span class="p">])</span>
    
    <span class="k">else</span><span class="p">:</span>
        
        <span class="n">qn</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Ic</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">eta_nu</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">qn</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">Ic</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">eta_nu</span><span class="p">])</span></div>

<div class="viewcode-block" id="load_ref"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.load_ref">[docs]</a><span class="k">def</span> <span class="nf">load_ref</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads the reference spectrum for the specified line.</span>
<span class="sd">    </span>
<span class="sd">    | Available lines:</span>
<span class="sd">    | RRL_CIalpha</span>
<span class="sd">    | RRL_CIbeta</span>
<span class="sd">    | RRL_CIdelta</span>
<span class="sd">    | RRL_CIgamma</span>
<span class="sd">    | RRL_CI13alpha</span>
<span class="sd">    | RRL_HeIalpha</span>
<span class="sd">    | RRL_HeIbeta</span>
<span class="sd">    | RRL_HIalpha</span>
<span class="sd">    | RRL_HIbeta</span>
<span class="sd">    | RRL_SIalpha</span>
<span class="sd">    | RRL_SIbeta</span>
<span class="sd">    </span>
<span class="sd">    More lines can be added by including a list in the </span>
<span class="sd">    linelist directory.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    line : string</span>
<span class="sd">           Line for which the principal quantum number and reference frequencies are desired.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n : array</span>
<span class="sd">            Principal quantum numbers. </span>
<span class="sd">    reference_frequencies : array</span>
<span class="sd">                            Reference frequencies of the lines inside the spectrum in MHz.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">LOCALDIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">refspec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">/linelist/</span><span class="si">{1}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOCALDIR</span><span class="p">,</span> <span class="n">line</span><span class="p">),</span>
                         <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">qn</span> <span class="o">=</span> <span class="n">refspec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">reffreq</span> <span class="o">=</span> <span class="n">refspec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">qn</span><span class="p">,</span> <span class="n">reffreq</span></div>

<div class="viewcode-block" id="lookup_freq"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.lookup_freq">[docs]</a><span class="k">def</span> <span class="nf">lookup_freq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the frequency of a line given the transition number n.</span>
<span class="sd">    </span>
<span class="sd">    :param n: Principal quantum number to look up for.</span>
<span class="sd">    :type n: int</span>
<span class="sd">    :param line: Line for which the frequency is desired.</span>
<span class="sd">    :type line: string</span>
<span class="sd">    :returns: Frequency of line(n).</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">qns</span><span class="p">,</span> <span class="n">freqs</span> <span class="o">=</span> <span class="n">load_ref</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">best_match_indx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">qns</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">freqs</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span></div>

<div class="viewcode-block" id="lorentz_width"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.lorentz_width">[docs]</a><span class="k">def</span> <span class="nf">lorentz_width</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">Tr</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">dn</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gives the Lorentzian line width due to a combination of radiation and \</span>
<span class="sd">    collisional broadening. The width is the FWHM in Hz. \</span>
<span class="sd">    It uses the models of Salgado et al. (2015).</span>
<span class="sd">    </span>
<span class="sd">    :param n: Principal quantum number for which to evaluate the Lorentz widths.</span>
<span class="sd">    :type n: array</span>
<span class="sd">    :param ne: Electron density to use in the collisional broadening term.</span>
<span class="sd">    :type ne: float</span>
<span class="sd">    :param Te: Electron temperature to use in the collisional broadening term.</span>
<span class="sd">    :type Te: float</span>
<span class="sd">    :param Tr: Radiation field temperature.</span>
<span class="sd">    :type Tr: float</span>
<span class="sd">    :param W: Cloud covering factor used in the radiation broadening term.</span>
<span class="sd">    :type W: float</span>
<span class="sd">    :param dn: Separation between the levels of the transition. e.g., `dn=1` for CIalpha.</span>
<span class="sd">    :type dn: int</span>
<span class="sd">    :returns: The Lorentz width of a line due to radiation and collisional broadening.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">dL_r</span> <span class="o">=</span> <span class="n">radiation_broad_salgado</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">Tr</span><span class="p">)</span>
    <span class="n">dL_p</span> <span class="o">=</span> <span class="n">pressure_broad_salgado</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">dn</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">dL_r</span> <span class="o">+</span> <span class="n">dL_p</span></div>

<div class="viewcode-block" id="mask_outliers"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.mask_outliers">[docs]</a><span class="k">def</span> <span class="nf">mask_outliers</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Masks values larger than m times the data median. \</span>
<span class="sd">    This is similar to sigma clipping.</span>
<span class="sd">    </span>
<span class="sd">    :param data: Data to mask.</span>
<span class="sd">    :type data: array</span>
<span class="sd">    :returns: An array of the same shape as data with True where the data \</span>
<span class="sd">    should be flagged.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; data = [1,2,3,4,5,6]</span>
<span class="sd">    &gt;&gt;&gt; mask_outliers(data, m=1)</span>
<span class="sd">    array([ True, False, False, False, False,  True], dtype=bool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="n2f"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.n2f">[docs]</a><span class="k">def</span> <span class="nf">n2f</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">n_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">unitless</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a given principal quantum number n to the </span>
<span class="sd">    frequency of a given line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">line</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">trans</span> <span class="o">=</span> <span class="n">make_line_list</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span><span class="p">,</span> <span class="n">unitless</span><span class="p">)</span>
    <span class="n">nii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">freq</span><span class="p">[</span><span class="n">nii</span><span class="p">]</span></div>

<div class="viewcode-block" id="natural_sort"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.natural_sort">[docs]</a><span class="k">def</span> <span class="nf">natural_sort</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Sort the given list in the way that humans expect. \</span>
<span class="sd">    Sorting is done in place.</span>
<span class="sd">    </span>
<span class="sd">    :param list: List to sort.</span>
<span class="sd">    :type list: list</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; my_list = [&#39;spec_3&#39;, &#39;spec_4&#39;, &#39;spec_1&#39;]</span>
<span class="sd">    &gt;&gt;&gt; natural_sort(my_list)</span>
<span class="sd">    &gt;&gt;&gt; my_list</span>
<span class="sd">    [&#39;spec_1&#39;, &#39;spec_3&#39;, &#39;spec_4&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="nb">list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">alphanum_key</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ngaussian"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.ngaussian">[docs]</a><span class="k">def</span> <span class="nf">ngaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalized Gaussian distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))</span></div>

<div class="viewcode-block" id="pressure_broad"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.pressure_broad">[docs]</a><span class="k">def</span> <span class="nf">pressure_broad</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">ne</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pressure induced broadening in Hz.</span>
<span class="sd">    Shaver (1975) Eq. (64a) for te &lt;= 1000 K and</span>
<span class="sd">    Eq. (61) for te &gt; 1000 K.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">te</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">dnup</span> <span class="o">=</span> <span class="mf">2e-5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">26.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">))</span><span class="o">*</span><span class="n">ne</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dnup</span> <span class="o">=</span> <span class="mf">3.74e-8</span><span class="o">*</span><span class="n">ne</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">dnup</span></div>

<div class="viewcode-block" id="pressure_broad_salgado"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.pressure_broad_salgado">[docs]</a><span class="k">def</span> <span class="nf">pressure_broad_salgado</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">dn</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pressure induced broadening in Hz.</span>
<span class="sd">    This gives the FWHM of a Lorentzian line.</span>
<span class="sd">    Salgado et al. (2015)</span>
<span class="sd">    </span>
<span class="sd">    :param n: Principal quantum number for which to compute the line broadening.</span>
<span class="sd">    :type n: float or array</span>
<span class="sd">    :param Te: Electron temperature to use when computing the collisional line width.</span>
<span class="sd">    :type Te: float</span>
<span class="sd">    :param ne: Electron density to use when computing the collisional line width.</span>
<span class="sd">    :type ne: float</span>
<span class="sd">    :param dn: Difference between the upper and lower level for which the line width is computed. (default 1)</span>
<span class="sd">    :type dn: int</span>
<span class="sd">    :returns: The collisional broadening FWHM in Hz using Salgado et al. (2015) formulas.</span>
<span class="sd">    :rtype: float or array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">a</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">pressure_broad_coefs</span><span class="p">(</span><span class="n">te</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ne</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">dn</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span></div>

<div class="viewcode-block" id="pressure_broad_coefs"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.pressure_broad_coefs">[docs]</a><span class="k">def</span> <span class="nf">pressure_broad_coefs</span><span class="p">(</span><span class="n">Te</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines the values of the constants :math:`a` and :math:`\\gamma` that go into the collisional broadening formula</span>
<span class="sd">    of Salgado et al. (2015).</span>
<span class="sd">    </span>
<span class="sd">    :param Te: Electron temperature.</span>
<span class="sd">    :type Te: float</span>
<span class="sd">    :returns: The values of :math:`a` and :math:`\\gamma`.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">te</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span>
          <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span>
          <span class="mi">800</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span>
          <span class="mi">6000</span><span class="p">,</span> <span class="mi">7000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">9000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">]</span>
    
    <span class="n">te_indx</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">best_match_indx</span><span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">te</span><span class="p">)</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">10.974098</span><span class="p">,</span>           
         <span class="o">-</span><span class="mf">10.669695</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.494541</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.370271</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.273172</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.191374</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.124309</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.064037</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">10.010153</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">9.9613006</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">9.6200366</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">9.4001678</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">9.2336349</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">9.0848840</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.9690170</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.8686695</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.7802238</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.7012421</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.6299908</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.2718376</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">8.0093937</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.8344941</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.7083367</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.6126791</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.5375720</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.4770500</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.4272885</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.3857095</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.1811733</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">7.1132522</span><span class="p">]</span>
    
    <span class="n">gammac</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.4821631</span><span class="p">,</span>
              <span class="mf">5.4354009</span><span class="p">,</span>
              <span class="mf">5.4071360</span><span class="p">,</span>
              <span class="mf">5.3861013</span><span class="p">,</span>
              <span class="mf">5.3689105</span><span class="p">,</span>
              <span class="mf">5.3535398</span><span class="p">,</span>
              <span class="mf">5.3409679</span><span class="p">,</span>
              <span class="mf">5.3290318</span><span class="p">,</span>
              <span class="mf">5.3180304</span><span class="p">,</span>
              <span class="mf">5.3077770</span><span class="p">,</span>
              <span class="mf">5.2283700</span><span class="p">,</span>
              <span class="mf">5.1700702</span><span class="p">,</span>
              <span class="mf">5.1224893</span><span class="p">,</span>
              <span class="mf">5.0770049</span><span class="p">,</span>
              <span class="mf">5.0408369</span><span class="p">,</span>
              <span class="mf">5.0086342</span><span class="p">,</span>
              <span class="mf">4.9796105</span><span class="p">,</span>
              <span class="mf">4.9532071</span><span class="p">,</span>
              <span class="mf">4.9290080</span><span class="p">,</span>
              <span class="mf">4.8063682</span><span class="p">,</span>
              <span class="mf">4.7057576</span><span class="p">,</span>
              <span class="mf">4.6356118</span><span class="p">,</span>
              <span class="mf">4.5831746</span><span class="p">,</span>
              <span class="mf">4.5421547</span><span class="p">,</span>
              <span class="mf">4.5090104</span><span class="p">,</span>
              <span class="mf">4.4815675</span><span class="p">,</span>
              <span class="mf">4.4584053</span><span class="p">,</span>
              <span class="mf">4.4385507</span><span class="p">,</span>
              <span class="mf">4.3290786</span><span class="p">,</span>
              <span class="mf">4.2814240</span><span class="p">]</span>
    
    <span class="n">a_func</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
                                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                  <span class="n">bounds_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="n">g_func</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">gammac</span><span class="p">,</span>
                                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                  <span class="n">bounds_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">a_func</span><span class="p">(</span><span class="n">Te</span><span class="p">),</span> <span class="n">g_func</span><span class="p">(</span><span class="n">Te</span><span class="p">)]</span></div>


<div class="viewcode-block" id="radiation_broad"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.radiation_broad">[docs]</a><span class="k">def</span> <span class="nf">radiation_broad</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">tr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radiation induced broadening in Hz.</span>
<span class="sd">    Shaver (1975)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="mf">8e-17</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="n">tr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">)</span></div>


<div class="viewcode-block" id="radiation_broad_salgado"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.radiation_broad_salgado">[docs]</a><span class="k">def</span> <span class="nf">radiation_broad_salgado</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">tr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radiation induced broadening in Hz.</span>
<span class="sd">    This gives the FWHM of a Lorentzian line.</span>
<span class="sd">    Salgado et al. (2015)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="mf">6.096e-17</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">tr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">)</span></div>


<div class="viewcode-block" id="radiation_broad_salgado_general"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.radiation_broad_salgado_general">[docs]</a><span class="k">def</span> <span class="nf">radiation_broad_salgado_general</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">nu0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Radiation induced broadening in Hz.</span>
<span class="sd">    This gives the FWHM of a Lorentzian line.</span>
<span class="sd">    The expression is valid for power law like radiation fields.</span>
<span class="sd">    Salgado et al. (2015)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">cte</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">2.14e4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">6.578e15</span><span class="o">/</span><span class="n">nu0</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">k_B</span><span class="o">.</span><span class="n">cgs</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">nu0</span>
    <span class="n">dnexp</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">-</span> <span class="mf">2.</span>
    
    <span class="k">return</span> <span class="n">w</span><span class="o">*</span><span class="n">cte</span><span class="o">*</span><span class="n">tr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="o">*</span><span class="n">alpha</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="n">dnexp</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="n">dnexp</span><span class="p">))</span></div>


<div class="viewcode-block" id="rval"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.rval">[docs]</a><span class="k">def</span> <span class="nf">rval</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">rates</span><span class="o">=</span><span class="s1">&#39;TH1985&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">rates</span> <span class="o">==</span> <span class="s1">&#39;TH1985&#39;</span><span class="p">:</span>
        <span class="n">gammah</span> <span class="o">=</span> <span class="mf">5.8e-10</span><span class="o">*</span><span class="n">te</span><span class="o">**</span><span class="mf">2e-2</span> <span class="c1"># cm3 s-1</span>
        <span class="n">gammae</span> <span class="o">=</span> <span class="mf">4.51e-6</span><span class="o">/</span><span class="n">te</span><span class="o">**</span><span class="mf">0.5</span> <span class="c1"># cm3 s-1</span>
    <span class="k">elif</span> <span class="n">rates</span> <span class="o">==</span> <span class="s1">&#39;PG2012&#39;</span><span class="p">:</span>
        <span class="n">gammah</span> <span class="o">=</span> <span class="mf">4e-11</span><span class="o">*</span><span class="p">(</span><span class="mf">16.</span> <span class="o">+</span> <span class="mf">3.5e-1</span><span class="o">*</span><span class="n">te</span><span class="o">**</span><span class="mf">5e-1</span> <span class="o">+</span> <span class="mf">48.</span><span class="o">/</span><span class="n">te</span><span class="p">)</span> <span class="c1"># cm3 s-1</span>
        <span class="n">gammae</span> <span class="o">=</span> <span class="mf">8.7e-8</span><span class="o">*</span><span class="p">(</span><span class="n">te</span><span class="o">/</span><span class="mf">2e3</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.7e-1</span><span class="p">)</span> <span class="c1"># cm3 s-1        </span>
    
    <span class="n">fac1</span> <span class="o">=</span> <span class="n">ne</span><span class="o">*</span><span class="n">gammae</span>
    <span class="n">fac2</span> <span class="o">=</span> <span class="n">nh</span><span class="o">*</span><span class="n">gammah</span>
    <span class="c1"># Level population of the fine structure line</span>
    <span class="c1"># N32*Ar+N32*ne*gammae+N32*nh*gammah = N12*ne* gammae+N12*nh*gammah</span>
    <span class="c1"># 2.4e-6 is the spontaneous emission coefficient for the C+ line</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">fac1</span> <span class="o">+</span> <span class="n">fac2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fac1</span> <span class="o">+</span> <span class="n">fac2</span> <span class="o">+</span> <span class="mf">2.4e-6</span><span class="p">)</span></div>


<div class="viewcode-block" id="sigma2fwhm"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.sigma2fwhm">[docs]</a><span class="k">def</span> <span class="nf">sigma2fwhm</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the :math:`\\sigma` parameter of a Gaussian distribution to its FWHM.</span>
<span class="sd">    </span>
<span class="sd">    :param sigma: :math:`\\sigma` value of the Gaussian distribution.</span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :returns: The FWHM of a Gaussian with a standard deviation :math:`\\sigma`.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">sigma</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">))</span></div>


<div class="viewcode-block" id="sigma2fwhm_err"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.sigma2fwhm_err">[docs]</a><span class="k">def</span> <span class="nf">sigma2fwhm_err</span><span class="p">(</span><span class="n">dsigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the error on the sigma parameter of a Gaussian distribution \</span>
<span class="sd">    to the error on the FWHM.</span>
<span class="sd">    </span>
<span class="sd">    :param dsigma: Error on sigma of the Gaussian distribution.</span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :returns: The error on the FWHM of a Gaussian with a standard deviation :math:`\\sigma`.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">dsigma</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">))</span></div>


<div class="viewcode-block" id="sigma2fwtm"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.sigma2fwtm">[docs]</a><span class="k">def</span> <span class="nf">sigma2fwtm</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the :math:`\\sigma` parameter of a Gaussian distribution to its FWTM.</span>
<span class="sd">    </span>
<span class="sd">    :math:`\mbox{FWTM}=2(2\log(10))^{1/2}\\sigma`</span>
<span class="sd">    </span>
<span class="sd">    :param sigma: Standard deviation of the Gaussian distribution.</span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :returns: Full width at a tenth of the maximum.</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">sigma</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span></div>


<div class="viewcode-block" id="signal2noise"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.signal2noise">[docs]</a><span class="k">def</span> <span class="nf">signal2noise</span><span class="p">(</span><span class="n">snr0</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Signal to noise ratio of the corresponding line property</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">cx</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;amplitude&#39;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">,</span>
          <span class="s1">&#39;center&#39;</span><span class="p">:</span><span class="mf">1.47</span><span class="p">,</span>
          <span class="s1">&#39;FWHM&#39;</span><span class="p">:</span><span class="mf">0.61</span><span class="p">,</span>
          <span class="s1">&#39;area&#39;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">}</span>
    
    <span class="k">return</span> <span class="n">cx</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fwhm</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="n">snr0</span></div>

<div class="viewcode-block" id="tryint"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.tryint">[docs]</a><span class="k">def</span> <span class="nf">tryint</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an integer if `str` can be represented as one.</span>
<span class="sd">    </span>
<span class="sd">    :param str: String to check.</span>
<span class="sd">    :type str: string</span>
<span class="sd">    :returns: True is str can be cast to an int.</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span></div>
    

<div class="viewcode-block" id="vel2freq"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.vel2freq">[docs]</a><span class="k">def</span> <span class="nf">vel2freq</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">vel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a velocity axis to a frequency axis given a central frequency.</span>
<span class="sd">    Uses the radio definition, :math:`\\nu=f_{0}(1-v/c)`.</span>
<span class="sd">    </span>
<span class="sd">    :param f0: Rest frequency in Hz.</span>
<span class="sd">    :type f0: float</span>
<span class="sd">    :param vel: Velocity to convert in m/s.</span>
<span class="sd">    :type vel: float or array</span>
<span class="sd">    :returns: The frequency which is equivalent to vel.</span>
<span class="sd">    :rtype: float or array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">f0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">vel</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="voigt_"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_">[docs]</a><span class="k">def</span> <span class="nf">voigt_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># The Voigt function is also the real part of </span>
    <span class="c1"># w(z) = exp(-z^2) erfc(iz), the complex probability function,</span>
    <span class="c1"># which is also known as the Faddeeva function. Scipy has </span>
    <span class="c1"># implemented this function under the name wofz()</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">wofz</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

    <span class="k">return</span> <span class="n">I</span></div>

<div class="viewcode-block" id="voigt"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt">[docs]</a><span class="k">def</span> <span class="nf">voigt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Voigt line shape in terms of its physical parameters.</span>
<span class="sd">    </span>
<span class="sd">    :param x: independent variable</span>
<span class="sd">    :param sigma: HWHM of the Gaussian</span>
<span class="sd">    :param gamma: HWHM of the Lorentzian</span>
<span class="sd">    :param center: the line center</span>
<span class="sd">    :param amplitude: the line area</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ln2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ln2</span><span class="p">)</span>
    <span class="n">rx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">f</span>
    <span class="n">ry</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">/</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">f</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">*</span><span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="n">voigt_</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">V</span></div>

<div class="viewcode-block" id="voigt_area"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_area">[docs]</a><span class="k">def</span> <span class="nf">voigt_area</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the area under a Voigt profile. \</span>
<span class="sd">    This approximation has an error of less than 0.5%</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">l</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">gamma</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sigma</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="o">/</span><span class="p">(</span><span class="n">g</span><span class="o">+</span><span class="n">l</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">1.572</span> <span class="o">+</span> <span class="mf">0.05288</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="o">-</span><span class="mf">1.323</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.7658</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">3</span>
    
    <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">amp</span><span class="o">*</span><span class="n">fwhm</span></div>

<div class="viewcode-block" id="voigt_area2"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_area2">[docs]</a><span class="k">def</span> <span class="nf">voigt_area2</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Area under the Voigt profile using the expression provided by Sorochenko &amp; Smirnov (1990).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    peak : :obj:`float`</span>
<span class="sd">          Peak of the Voigt line profile.</span>
<span class="sd">    fwhm : :obj:`float`</span>
<span class="sd">          Full width at half maximum of the Voigt profile.</span>
<span class="sd">    gamma : :obj:`float`</span>
<span class="sd">          Full width at half maximum of the Lorentzian profile.</span>
<span class="sd">    sigma : :obj:`float`</span>
<span class="sd">          Full width at half maximum of the Doppler profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="mf">1.57</span> <span class="o">-</span> <span class="mf">0.507</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.85</span><span class="o">*</span><span class="n">gamma</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">peak</span><span class="o">*</span><span class="n">fwhm</span><span class="o">*</span><span class="n">p</span></div>

<div class="viewcode-block" id="voigt_area_err"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_area_err">[docs]</a><span class="k">def</span> <span class="nf">voigt_area_err</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">damp</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">dfwhm</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the error of the area under a Voigt profile. \</span>
<span class="sd">    Assumes that the parameter c has an error of 0.5%.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">l</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">gamma</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sigma</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="o">/</span><span class="p">(</span><span class="n">g</span><span class="o">+</span><span class="n">l</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">1.572</span> <span class="o">+</span> <span class="mf">0.05288</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="o">-</span><span class="mf">1.323</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.7658</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">3</span>
    
    <span class="n">err_a</span> <span class="o">=</span> <span class="n">area</span><span class="o">/</span><span class="n">amp</span><span class="o">*</span><span class="n">damp</span>
    <span class="n">err_f</span> <span class="o">=</span> <span class="n">area</span><span class="o">/</span><span class="n">fwhm</span><span class="o">*</span><span class="n">dfwhm</span>
    <span class="n">err_c</span> <span class="o">=</span> <span class="n">area</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="mf">100.0</span>
    
    <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err_a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_f</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">err</span></div>

<div class="viewcode-block" id="voigt_fwhm"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_fwhm">[docs]</a><span class="k">def</span> <span class="nf">voigt_fwhm</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="n">dL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the FWHM of a Voigt profile. \</span>
<span class="sd">    http://en.wikipedia.org/wiki/Voigt_profile#The_width_of_the_Voigt_profile</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">    </span>
<span class="sd">        FWHM_{\\rm{V}}=0.5346dL+\\sqrt{0.2166dL^{2}+dD^{2}}</span>
<span class="sd">    </span>
<span class="sd">    :param dD: FWHM of the Gaussian core.</span>
<span class="sd">    :type dD: array</span>
<span class="sd">    :param dL: FWHM of the Lorentz wings.</span>
<span class="sd">    :type dL: array</span>
<span class="sd">    :returns: The FWHM of a Voigt profile.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5346</span><span class="p">,</span> <span class="n">dL</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.2166</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dL</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span></div>


<div class="viewcode-block" id="voigt_fwhm_err"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_fwhm_err">[docs]</a><span class="k">def</span> <span class="nf">voigt_fwhm_err</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="n">dL</span><span class="p">,</span> <span class="n">ddD</span><span class="p">,</span> <span class="n">ddL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the error in the FWHM of a Voigt profile. \</span>
<span class="sd">    http://en.wikipedia.org/wiki/Voigt_profile#The_width_of_the_Voigt_profile</span>
<span class="sd">    </span>
<span class="sd">    :param dD: FWHM of the Gaussian core.</span>
<span class="sd">    :type dD: array</span>
<span class="sd">    :param dL: FWHM of the Lorentz wings.</span>
<span class="sd">    :type dL: array</span>
<span class="sd">    :param ddD: Error on the FWHM of the Gaussian.</span>
<span class="sd">    :type ddD: array</span>
<span class="sd">    :param ddL: Error on the FWHM of the Lorentzian.</span>
<span class="sd">    :type ddL: array</span>
<span class="sd">    :returns: The FWHM of a Voigt profile.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">f</span> <span class="o">=</span> <span class="mf">0.02</span><span class="o">/</span><span class="mf">100.</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5346</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.2166</span>
    
    <span class="n">dT1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">dL</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">ddL</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">dT2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="n">ddD</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dT1</span> <span class="o">+</span> <span class="n">dT2</span><span class="p">)</span>
    
    <span class="n">dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dT</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">voigt_fwhm</span><span class="p">(</span><span class="n">dD</span><span class="p">,</span> <span class="n">dL</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">dT</span></div>


<div class="viewcode-block" id="voigt_peak"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_peak">[docs]</a><span class="k">def</span> <span class="nf">voigt_peak</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">alphaD</span><span class="p">,</span> <span class="n">alphaL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gives the peak of a Voigt profile given its Area and the \</span>
<span class="sd">    Half Width at Half Maximum of the Gaussian and Lorentz profiles.</span>
<span class="sd">    </span>
<span class="sd">    :param A: Area of the Voigt profile.</span>
<span class="sd">    :type A: array</span>
<span class="sd">    :param alphaD: HWHM of the Gaussian core.</span>
<span class="sd">    :type alphaD: array</span>
<span class="sd">    :param alphaL: HWHM of the Lorentz wings.</span>
<span class="sd">    :type alphaL: array</span>
<span class="sd">    :returns: The peak of the Voigt profile.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">alphaL</span><span class="o">/</span><span class="n">alphaD</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">wofz</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    
    <span class="n">peak</span> <span class="o">=</span> <span class="n">A</span><span class="o">/</span><span class="n">alphaD</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">K</span>
    
    <span class="k">return</span> <span class="n">peak</span></div>


<div class="viewcode-block" id="voigt_peak2area"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_peak2area">[docs]</a><span class="k">def</span> <span class="nf">voigt_peak2area</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">alphaD</span><span class="p">,</span> <span class="n">alphaL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the peak of a Voigt profile into the area under the profile \</span>
<span class="sd">    given the Half Width at Half Maximum of the profile components.</span>
<span class="sd">    </span>
<span class="sd">    :param peak: Peak of the Voigt profile.</span>
<span class="sd">    :type peak: array</span>
<span class="sd">    :param alphaD: HWHM of the Gaussian core.</span>
<span class="sd">    :type alphaD: array</span>
<span class="sd">    :param alphaL: HWHM of the Lorentz wings.</span>
<span class="sd">    :type alphaL: array</span>
<span class="sd">    :returns: The area under the Voigt profile.</span>
<span class="sd">    :rtype: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">alphaL</span><span class="o">/</span><span class="n">alphaD</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">wofz</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="n">peak</span><span class="o">*</span><span class="n">alphaD</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">A</span></div>
    

<div class="viewcode-block" id="voigt_peak_err"><a class="viewcode-back" href="../../crrls.html#crrlpy.crrls.voigt_peak_err">[docs]</a><span class="k">def</span> <span class="nf">voigt_peak_err</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">dA</span><span class="p">,</span> <span class="n">alphaD</span><span class="p">,</span> <span class="n">dalphaD</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gives the error on the peak of the Voigt profile. \</span>
<span class="sd">    It assumes no correlation between the parameters and that they are \</span>
<span class="sd">    normally distributed.</span>
<span class="sd">    </span>
<span class="sd">    :param peak: Peak of the Voigt profile.</span>
<span class="sd">    :type peak: array</span>
<span class="sd">    :param A: Area under the Voigt profile.</span>
<span class="sd">    :param dA: Error on the area `A`.</span>
<span class="sd">    :type dA: array</span>
<span class="sd">    :param alphaD: HWHM of the Gaussian core.</span>
<span class="sd">    :type alphaD: array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">dpeak</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">peak</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dalphaD</span><span class="o">/</span><span class="n">alphaD</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">dA</span><span class="o">/</span><span class="n">A</span><span class="p">,</span> <span class="mf">2.</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">dpeak</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CRRLpy 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Pedro Salas.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.
    </div>
  </body>
</html>